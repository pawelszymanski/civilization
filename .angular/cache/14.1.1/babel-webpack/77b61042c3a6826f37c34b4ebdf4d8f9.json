{"ast":null,"code":"import { UserActionId } from '../../models/key-bindings';\nimport { ModalId, ScreenId, SidebarId } from '../../models/ui';\nimport { TileInfoOverlayId, TileResourceOverlayId } from '../../models/gameplay-ui';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/keyboard.service\";\nimport * as i2 from \"../../stores/ui.store\";\nimport * as i3 from \"../../stores/gameplay-ui.store\";\nimport * as i4 from \"../../stores/key-bindings.store\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"../main-menu/main-menu.component\";\nimport * as i7 from \"../map/map.component\";\nimport * as i8 from \"../hud/status-bar/status-bar.component\";\nimport * as i9 from \"../hud/quick-links/quick-links.component\";\nimport * as i10 from \"../hud/mini-map/mini-map.component\";\nimport * as i11 from \"../hud/screen-center-marker/screen-center-marker.component\";\nimport * as i12 from \"../modals/research/civic-tree/civic-tree.component\";\nimport * as i13 from \"../modals/research/technology-tree/technology-tree.component\";\nimport * as i14 from \"../modals/menus/in-game-menu/in-game-menu.component\";\nimport * as i15 from \"../modals/save-and-load/save-game/save-game.component\";\nimport * as i16 from \"../modals/save-and-load/load-game/load-game.component\";\nimport * as i17 from \"../modals/menus/game-options-menu/game-options-menu.component\";\nimport * as i18 from \"../modals/menus/exit-game-confirmation/exit-game-confirmation.component\";\nimport * as i19 from \"../sidebars/world-builder/world-builder.component\";\nimport * as i20 from \"../sidebars/dev-tools/dev-tools.component\";\nconst _c0 = [\"class\", \"app-component\"];\n\nfunction AppComponent_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelement(1, \"div\", 7);\n    i0.ɵɵelementContainerEnd();\n  }\n}\n\nfunction AppComponent_ng_container_1_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 15);\n  }\n}\n\nfunction AppComponent_ng_container_1_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 16);\n  }\n}\n\nfunction AppComponent_ng_container_1_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 17);\n  }\n}\n\nfunction AppComponent_ng_container_1_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 18);\n  }\n}\n\nfunction AppComponent_ng_container_1_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 19);\n  }\n}\n\nfunction AppComponent_ng_container_1_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 20);\n  }\n}\n\nfunction AppComponent_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelement(1, \"div\", 8);\n    i0.ɵɵtemplate(2, AppComponent_ng_container_1_div_2_Template, 1, 0, \"div\", 9);\n    i0.ɵɵtemplate(3, AppComponent_ng_container_1_div_3_Template, 1, 0, \"div\", 10);\n    i0.ɵɵtemplate(4, AppComponent_ng_container_1_div_4_Template, 1, 0, \"div\", 11);\n    i0.ɵɵtemplate(5, AppComponent_ng_container_1_div_5_Template, 1, 0, \"div\", 12);\n    i0.ɵɵtemplate(6, AppComponent_ng_container_1_div_6_Template, 1, 0, \"div\", 13);\n    i0.ɵɵtemplate(7, AppComponent_ng_container_1_div_7_Template, 1, 0, \"div\", 14);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.ui.sidebar !== ctx_r1.SidebarId.WORLD_BUILDER);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.ui.sidebar !== ctx_r1.SidebarId.WORLD_BUILDER);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.gameplayUi.showMinimap);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.ui.sidebar === ctx_r1.SidebarId.DEV_TOOLS);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.ui.sidebar === ctx_r1.SidebarId.WORLD_BUILDER);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.ui.sidebar === ctx_r1.SidebarId.DEV_TOOLS);\n  }\n}\n\nfunction AppComponent_ng_container_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelement(1, \"div\", 21)(2, \"div\", 22);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵclassProp(\"active\", ctx_r2.ui.modal === ctx_r2.ModalId.CIVIC_TREE);\n    i0.ɵɵadvance(1);\n    i0.ɵɵclassProp(\"active\", ctx_r2.ui.modal === ctx_r2.ModalId.TECH_TREE);\n  }\n}\n\nfunction AppComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 23);\n  }\n}\n\nfunction AppComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 24);\n  }\n}\n\nfunction AppComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 25);\n  }\n}\n\nfunction AppComponent_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 26);\n  }\n}\n\nfunction AppComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 27);\n  }\n}\n\nexport let AppComponent = /*#__PURE__*/(() => {\n  class AppComponent {\n    constructor(keyboardService, uiStore, gameplayUiStore, keyBindingsStore) {\n      this.keyboardService = keyboardService;\n      this.uiStore = uiStore;\n      this.gameplayUiStore = gameplayUiStore;\n      this.keyBindingsStore = keyBindingsStore;\n      this.ModalId = ModalId;\n      this.ScreenId = ScreenId;\n      this.SidebarId = SidebarId;\n      this.subscriptions = [];\n    }\n\n    ngOnInit() {\n      this.subscribeToData();\n      this.addEventListeners();\n    }\n\n    subscribeToData() {\n      this.subscriptions.push(this.uiStore.ui.subscribe(ui => this.ui = ui), this.gameplayUiStore.gameplayUi.subscribe(gameplayUi => this.gameplayUi = gameplayUi), this.keyBindingsStore.keyBindings.subscribe(keyBindings => this.keyBindings = keyBindings));\n    }\n\n    ngOnDestroy() {\n      this.unsubscribeFromData();\n    }\n\n    addEventListeners() {\n      // Using listeners rather than @HostListener since they could be called with .stopPropagation()\n      document.addEventListener('wheel', this.documentOnWheel.bind(this), {\n        passive: false\n      });\n      document.addEventListener('contextmenu', this.documentOnContextMenu.bind(this));\n      document.addEventListener('keydown', this.documentOnKeydown.bind(this));\n    }\n\n    unsubscribeFromData() {\n      this.subscriptions.forEach(s => s.unsubscribe());\n    }\n\n    documentOnWheel(event) {\n      if (event.ctrlKey) {\n        event.preventDefault();\n      }\n    }\n\n    documentOnContextMenu(event) {\n      if (this.ui.sidebar !== SidebarId.DEV_TOOLS) {\n        event.preventDefault();\n      }\n    }\n\n    documentOnKeydown(event) {\n      // proceed only if outside of an input\n      const isInput = event.target.tagName.toUpperCase() === 'INPUT';\n\n      if (isInput) {\n        return;\n      }\n\n      event.preventDefault();\n      const keyBinding = this.keyboardService.keyBindingFromEvent(event);\n      const userActionId = this.keyboardService.findMatchingActionId(this.keyBindings, keyBinding);\n\n      if (userActionId === UserActionId.ESCAPE_VIEW) {\n        this.uiStore.escapeView();\n      } else if (userActionId === UserActionId.TOGGLE_TECH_TREE) {\n        this.uiStore.toggleModal(ModalId.TECH_TREE);\n      } else if (userActionId === UserActionId.TOGGLE_CIVICS_TREE) {\n        this.uiStore.toggleModal(ModalId.CIVIC_TREE);\n      } else if (userActionId === UserActionId.TOGGLE_WORLD_BUILDER) {\n        this.uiStore.toggleSidebar(SidebarId.WORLD_BUILDER);\n      } else if (userActionId === UserActionId.TOGGLE_DEV_TOOLS) {\n        this.uiStore.toggleSidebar(SidebarId.DEV_TOOLS);\n      } else if (userActionId === UserActionId.TOGGLE_TILE_INFO_OVERLAY_YIELD) {\n        this.gameplayUiStore.toggleTileInfoOverlay(TileInfoOverlayId.YIELD);\n      } else if (userActionId === UserActionId.TOGGLE_TILE_INFO_OVERLAY_TEXT) {\n        this.gameplayUiStore.toggleTileInfoOverlay(TileInfoOverlayId.TEXT);\n      } else if (userActionId === UserActionId.TOGGLE_TILE_RESOURCE_OVERLAY_ALL) {\n        this.gameplayUiStore.toggleTileResourceOverlay(TileResourceOverlayId.ALL);\n      } else if (userActionId === UserActionId.TOGGLE_MINIMAP) {\n        this.gameplayUiStore.toggleMinimap();\n      }\n\n      if (userActionId === UserActionId.TOGGLE_GRID) {\n        this.gameplayUiStore.toggleGrid();\n      }\n    }\n\n  }\n\n  AppComponent.ɵfac = function AppComponent_Factory(t) {\n    return new (t || AppComponent)(i0.ɵɵdirectiveInject(i1.KeyboardService), i0.ɵɵdirectiveInject(i2.UiStore), i0.ɵɵdirectiveInject(i3.GameplayUiStore), i0.ɵɵdirectiveInject(i4.KeyBindingsStore));\n  };\n\n  AppComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AppComponent,\n    selectors: [[\"\", 8, \"app-component\"]],\n    attrs: _c0,\n    decls: 9,\n    vars: 10,\n    consts: [[4, \"ngIf\"], [1, \"modal-overlay\"], [\"class\", \"in-game-menu-component\", 4, \"ngIf\"], [\"class\", \"save-game-component\", 4, \"ngIf\"], [\"class\", \"load-game-component\", 4, \"ngIf\"], [\"class\", \"game-options-menu-component\", 4, \"ngIf\"], [\"class\", \"exit-game-confirmation-component\", 4, \"ngIf\"], [1, \"main-menu-component\"], [1, \"map-component\"], [\"class\", \"status-bar-component\", 4, \"ngIf\"], [\"class\", \"quick-links-component\", 4, \"ngIf\"], [\"class\", \"mini-map-component\", 4, \"ngIf\"], [\"class\", \"dev-tools-component\", 4, \"ngIf\"], [\"class\", \"world-builder-component\", 4, \"ngIf\"], [\"class\", \"screen-center-marker-component\", 4, \"ngIf\"], [1, \"status-bar-component\"], [1, \"quick-links-component\"], [1, \"mini-map-component\"], [1, \"dev-tools-component\"], [1, \"world-builder-component\"], [1, \"screen-center-marker-component\"], [1, \"civic-tree-component\", \"research-tree-modal\"], [1, \"technology-tree-component\", \"research-tree-modal\"], [1, \"in-game-menu-component\"], [1, \"save-game-component\"], [1, \"load-game-component\"], [1, \"game-options-menu-component\"], [1, \"exit-game-confirmation-component\"]],\n    template: function AppComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, AppComponent_ng_container_0_Template, 2, 0, \"ng-container\", 0);\n        i0.ɵɵtemplate(1, AppComponent_ng_container_1_Template, 8, 6, \"ng-container\", 0);\n        i0.ɵɵelementStart(2, \"div\", 1);\n        i0.ɵɵtemplate(3, AppComponent_ng_container_3_Template, 3, 4, \"ng-container\", 0);\n        i0.ɵɵtemplate(4, AppComponent_div_4_Template, 1, 0, \"div\", 2);\n        i0.ɵɵtemplate(5, AppComponent_div_5_Template, 1, 0, \"div\", 3);\n        i0.ɵɵtemplate(6, AppComponent_div_6_Template, 1, 0, \"div\", 4);\n        i0.ɵɵtemplate(7, AppComponent_div_7_Template, 1, 0, \"div\", 5);\n        i0.ɵɵtemplate(8, AppComponent_div_8_Template, 1, 0, \"div\", 6);\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", ctx.ui.screen === ctx.ScreenId.MAIN_MENU);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.ui.screen === ctx.ScreenId.GAMEPLAY);\n        i0.ɵɵadvance(1);\n        i0.ɵɵclassProp(\"active\", ctx.ui.modal !== ctx.ModalId.NONE);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.ui.screen === ctx.ScreenId.GAMEPLAY);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.ui.modal === ctx.ModalId.IN_GAME_MENU);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.ui.modal === ctx.ModalId.SAVE_GAME);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.ui.modal === ctx.ModalId.LOAD_GAME);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.ui.modal === ctx.ModalId.GAMEPLAY_OPTIONS_MENU);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.ui.modal === ctx.ModalId.EXIT_GAME_CONFIRMATION);\n      }\n    },\n    dependencies: [i5.NgIf, i6.MainMenuComponent, i7.MapComponent, i8.StatusBarComponent, i9.QuickLinksComponent, i10.MiniMapComponent, i11.ScreenCenterMarkerComponent, i12.CivicTreeComponent, i13.TechnologyTreeComponent, i14.InGameMenuComponent, i15.SaveGameComponent, i16.LoadGameComponent, i17.GameOptionsMenuComponent, i18.ExitGameConfirmationComponent, i19.WorldBuilderComponent, i20.DevToolsComponent],\n    styles: [\".app-component{width:100%;height:100%;position:relative}.app-component .modal-overlay{position:absolute;top:0;right:0;bottom:0;left:0;z-index:-1;background-color:#0000;transition:background-color .35s linear}.app-component .modal-overlay.active{background-color:#00000040;z-index:400}\\n\"],\n    encapsulation: 2\n  });\n  return AppComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}